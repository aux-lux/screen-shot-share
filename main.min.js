!function(t,e,n){function i(i,u){var y=this;d=e.getElementById(i),c=e.getElementById(i).getContext("2d");var f,p,b=!1,v=!1;e.addEventListener("keydown",function(t){y.on_keyboard_action(t)},!1),e.addEventListener("keyup",function(t){y.on_keyboardup_action(t)},!1),e.addEventListener("paste",function(t){y.paste_auto(t)},!1),this.init=function(){p=e.createElement("div"),p.setAttribute("id","paste_ff"),p.setAttribute("contenteditable",""),p.style.cssText="opacity:0;position:fixed;top:0px;left:0px;width:10px;margin-left:-20px;",e.body.appendChild(p);var t=new MutationObserver(function(t){t.forEach(function(t){return f===!0||0==b||"childList"!=t.type?!0:void(1==t.addedNodes.length&&(t.addedNodes[0].src!=n&&y.paste_createImage(t.addedNodes[0].src),setTimeout(function(){p.innerHTML=""},20)))})}),i=e.getElementById("paste_ff"),a={attributes:!0,childList:!0,characterData:!0};t.observe(i,a)}(),this.paste_auto=function(e){if(f=!1,p!=n&&(p.innerHTML=""),e.clipboardData){var i=e.clipboardData.items;if(i){f=!0;for(var a=0;a<i.length;a++)if(-1!==i[a].type.indexOf("image")){var o=i[a].getAsFile(),d=t.URL||t.webkitURL,c=d.createObjectURL(o);this.paste_createImage(c)}e.preventDefault()}}},this.on_keyboard_action=function(t){if(k=t.keyCode,(17==k||t.metaKey||t.ctrlKey)&&0==b&&(b=!0),86==k){if(e.activeElement!=n&&"text"==e.activeElement.type)return!1;1==b&&p!=n&&p.focus()}},this.on_keyboardup_action=function(t){0==t.ctrlKey&&1==b?b=!1:0==t.metaKey&&1==v&&(v=!1,b=!1)},this.paste_createImage=function(t){e.getElementById("note").style.display="none",r=new Image,r.onload=function(){d.width=c.width=r.width,d.height=c.height=r.height,d.removeAttribute("style"),d.style.cursor="crosshair",c.drawImage(r,0,0)},r.src=t,d.addEventListener("mousedown",function(t){s={x:t.clientX+Math.max(e.documentElement.scrollLeft,e.body.scrollLeft),y:t.clientY+Math.max(e.documentElement.scrollTop,e.body.scrollTop)},m=!0}),d.addEventListener("mousemove",function(t){m&&(l={x:t.clientX+Math.max(e.documentElement.scrollLeft,e.body.scrollLeft),y:t.clientY+Math.max(e.documentElement.scrollTop,e.body.scrollTop)},o(s.x,s.y,l.x,l.y),h=!0)}),e.addEventListener("mouseup",function(t){m&&(h?a(s.x,s.y,l.x,l.y):a(0,0,r.width,r.height),e.body.removeChild(d),m=!1)})}}function a(t,n,i,a){var o=e.createElement("canvas"),c=o.getContext("2d"),r={x:Math.min(t,i),y:Math.min(n,a),w:Math.abs(t-i),h:Math.abs(n-a)};o.width=c.width=r.w,o.height=c.height=r.h,c.drawImage(d,r.x,r.y,r.w,r.h,0,0,r.w,r.h);var s=o.toDataURL(),l=e.createElement("form"),h=e.createElement("input");l.appendChild(h),h.setAttribute("name","photo"),l.setAttribute("method","post"),h.value=s,l.style.display="none",e.body.appendChild(l),l.submit()}function o(t,e,n,i){var a={x:Math.min(t,n),y:Math.min(e,i),w:Math.abs(t-n),h:Math.abs(e-i)};c.drawImage(r,0,0),c.fillStyle="rgba(0,0,0,0.5)",c.fillRect(0,0,r.width,a.y),c.fillRect(0,a.y+a.h,r.width,r.height-a.y-a.h),c.fillRect(0,a.y,a.x,a.h),c.fillRect(a.x+a.w,a.y,r.width-a.x-a.w,a.h)}var d,c,r,s,l,h=(new i("my_canvas",!0),!1),m=!1}(window,document);