!function(a,b,c){function m(d,m){var p=this;e=b.getElementById(d),f=b.getElementById(d).getContext("2d");var s,t,q=!1,r=!1;b.addEventListener("keydown",function(a){p.on_keyboard_action(a)},!1),b.addEventListener("keyup",function(a){p.on_keyboardup_action(a)},!1),b.addEventListener("paste",function(a){p.paste_auto(a)},!1),this.init=function(){t=b.createElement("div"),t.setAttribute("id","paste_ff"),t.setAttribute("contenteditable",""),t.style.cssText="opacity:0;position:fixed;top:0px;left:0px;width:10px;margin-left:-20px;",b.body.appendChild(t);var a=new MutationObserver(function(a){a.forEach(function(a){return s===!0||0==q||"childList"!=a.type||void(1==a.addedNodes.length&&(a.addedNodes[0].src!=c&&p.paste_createImage(a.addedNodes[0].src),setTimeout(function(){t.innerHTML=""},20)))})}),d=b.getElementById("paste_ff"),e={attributes:!0,childList:!0,characterData:!0};a.observe(d,e)}(),this.paste_auto=function(b){if(s=!1,t!=c&&(t.innerHTML=""),b.clipboardData){var d=b.clipboardData.items;if(d){s=!0;for(var e=0;e<d.length;e++)if(d[e].type.indexOf("image")!==-1){var f=d[e].getAsFile(),g=a.URL||a.webkitURL,h=g.createObjectURL(f);this.paste_createImage(h)}b.preventDefault()}}},this.on_keyboard_action=function(a){if(k=a.keyCode,(17==k||a.metaKey||a.ctrlKey)&&0==q&&(q=!0),86==k){if(b.activeElement!=c&&"text"==b.activeElement.type)return!1;1==q&&t!=c&&t.focus()}},this.on_keyboardup_action=function(a){0==a.ctrlKey&&1==q?q=!1:0==a.metaKey&&1==r&&(r=!1,q=!1)},this.paste_createImage=function(a){b.getElementById("note").style.display="none",g=new Image,g.onload=function(){e.width=f.width=g.width,e.height=f.height=g.height,e.removeAttribute("style"),e.style.cursor="crosshair",f.drawImage(g,0,0)},g.src=a,e.addEventListener("mousedown",function(a){h={x:a.clientX,y:a.clientY},l=!0}),e.addEventListener("mousemove",function(a){l&&(i={x:a.clientX,y:a.clientY},o(h.x,h.y,i.x,i.y),j=!0)}),b.addEventListener("mouseup",function(a){l&&(j?n(h.x,h.y,i.x,i.y):n(0,0,g.width,g.height),b.body.removeChild(e),l=!1)})}}function n(a,c,d,f){var g=b.createElement("canvas"),h=g.getContext("2d"),i={x:Math.min(a,d),y:Math.min(c,f),w:Math.abs(a-d),h:Math.abs(c-f)};g.width=h.width=i.w,g.height=h.height=i.h,h.drawImage(e,i.x,i.y,i.w,i.h,0,0,i.w,i.h);var j=g.toDataURL("image/jpeg",.8),k=b.createElement("form"),l=b.createElement("input");k.appendChild(l),l.setAttribute("name","photo"),k.setAttribute("method","post"),l.value=j,k.style.display="none",b.body.appendChild(k),k.submit()}function o(a,b,c,d){var e={x:Math.min(a,c),y:Math.min(b,d),w:Math.abs(a-c),h:Math.abs(b-d)};f.drawImage(g,0,0),f.fillStyle="rgba(0,0,0,0.5)",f.fillRect(0,0,g.width,e.y),f.fillRect(0,e.y+e.h,g.width,g.height-e.y-e.h),f.fillRect(0,e.y,e.x,e.h),f.fillRect(e.x+e.w,e.y,g.width-e.x-e.w,e.h)}var e,f,g,h,i,j=(new m("my_canvas",!0),!1),l=!1}(window,document);